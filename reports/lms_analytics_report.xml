<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Course Completion Report -->
    <template id="report_lms_course_completion">
        <t t-call="web.html_container">
            <div class="header" style="text-align: center; margin-bottom: 40px;">
                <h1>Course Completion Report</h1>
                <p>Generated on <span t-esc="context_timestamp"/></p>
            </div>
            
            <t t-foreach="docs" t-as="course">
                <div class="course-section" style="margin-bottom: 40px; page-break-inside: avoid;">
                    <h2 t-esc="course.name"/>
                    
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0;">
                        <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 style="color: #007bff; margin: 0;" t-esc="course.total_enrollments"/>
                            <p style="margin: 5px 0 0 0; color: #6c757d;">Total Enrollments</p>
                        </div>
                        <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 style="color: #28a745; margin: 0;" t-esc="course.completed_enrollments"/>
                            <p style="margin: 5px 0 0 0; color: #6c757d;">Completed</p>
                        </div>
                        <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 style="color: #ffc107; margin: 0;" t-esc="'%.1f' % course.completion_rate"/>%
                            <p style="margin: 5px 0 0 0; color: #6c757d;">Completion Rate</p>
                        </div>
                        <div class="stat-card" style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                            <h3 style="color: #17a2b8; margin: 0;" t-esc="'%.1f' % course.average_score"/>%
                            <p style="margin: 5px 0 0 0; color: #6c757d;">Average Score</p>
                        </div>
                    </div>
                    
                    <!-- Enrollment Progress -->
                    <h3>Enrollment Progress</h3>
                    <table class="table table-bordered" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #343a40; color: white;">
                                <th style="padding: 12px; text-align: left;">Student</th>
                                <th style="padding: 12px; text-align: center;">Progress</th>
                                <th style="padding: 12px; text-align: center;">Score</th>
                                <th style="padding: 12px; text-align: center;">Status</th>
                                <th style="padding: 12px; text-align: center;">Enrollment Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="course.enrollments" t-as="enrollment">
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #dee2e6;">
                                        <t t-esc="enrollment.student_id.name"/>
                                    </td>
                                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                                        <t t-esc="'%.1f' % enrollment.progress"/>%
                                    </td>
                                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                                        <t t-esc="'%.1f' % (enrollment.score or 0)"/>%
                                    </td>
                                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                                        <span t-att-class="'badge ' + ('badge-success' if enrollment.state == 'completed' else 'badge-warning' if enrollment.state == 'in_progress' else 'badge-secondary')"
                                              t-esc="enrollment.state"/>
                                    </td>
                                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                                        <t t-esc="enrollment.enrollment_date"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </t>
        </t>
    </template>

    <!-- Corporate Training Report -->
    <template id="report_lms_corporate_training">
        <t t-call="web.html_container">
            <div class="header" style="text-align: center; margin-bottom: 40px;">
                <h1>Corporate Training Report</h1>
                <h2 t-esc="company.name"/>
                <p>Period: <span t-esc="date_from"/> to <span t-esc="date_to"/></p>
            </div>
            
            <!-- Executive Summary -->
            <div class="executive-summary" style="background: #f8f9fa; padding: 30px; border-radius: 10px; margin-bottom: 40px;">
                <h3>Executive Summary</h3>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 20px;">
                    <div style="text-align: center;">
                        <h4 style="color: #007bff; margin: 0;" t-esc="report_data.total_employees"/>
                        <p>Total Employees</p>
                    </div>
                    <div style="text-align: center;">
                        <h4 style="color: #28a745; margin: 0;" t-esc="report_data.enrolled_employees"/>
                        <p>Employees Enrolled</p>
                    </div>
                    <div style="text-align: center;">
                        <h4 style="color: #ffc107; margin: 0;" t-esc="report_data.total_enrollments"/>
                        <p>Total Enrollments</p>
                    </div>
                    <div style="text-align: center;">
                        <h4 style="color: #17a2b8; margin: 0;" t-esc="'%.1f' % report_data.completion_statistics.completion_rate"/>%
                        <p>Completion Rate</p>
                    </div>
                </div>
            </div>
            
            <!-- Department Performance -->
            <h3>Department Performance</h3>
            <table class="table table-bordered" style="width: 100%; border-collapse: collapse; margin-bottom: 40px;">
                <thead>
                    <tr style="background: #343a40; color: white;">
                        <th style="padding: 12px; text-align: left;">Department</th>
                        <th style="padding: 12px; text-align: center;">Total Employees</th>
                        <th style="padding: 12px; text-align: center;">Enrolled</th>
                        <th style="padding: 12px; text-align: center;">Completion Rate</th>
                        <th style="padding: 12px; text-align: center;">Avg Score</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="report_data.department_breakdown" t-as="dept">
                        <tr>
                            <td style="padding: 10px; border: 1px solid #dee2e6;" t-esc="dept.department_name"/>
                            <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;" t-esc="dept.total_employees"/>
                            <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;" t-esc="dept.enrolled_employees"/>
                            <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;" t-esc="'%.1f' % dept.completion_rate"/>%
                            <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;" t-esc="'%.1f' % dept.average_score"/>%
                        </tr>
                    </t>
                </tbody>
            </table>
            
            <!-- Course Performance -->
            <h3>Course Performance</h3>
            <table class="table table-bordered" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #343a40; color: white;">
                        <th style="padding: 12px; text-align: left;">Course</th>
                        <th style="padding: 12px; text-align: center;">Enrollments</th>
                        <th style="padding: 12px; text-align: center;">Completed</th>
                        <th style="padding: 12px; text-align: center;">Completion Rate</th>
                        <th style="padding: 12px; text-align: center;">Avg Score</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="report_data.course_performance" t-as="course">
                        <tr>
                            <td style="padding: 10px; border: 1px solid #dee2e6;" t-esc="course.course_name"/>
                            <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;" t-esc="course.total_enrollments"/>
                            <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;" t-esc="course.completed"/>
                            <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;" t-esc="'%.1f' % course.completion_rate"/>%
                            <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;" t-esc="'%.1f' % course.average_score"/>%
                        </tr>
                    </t>
                </tbody>
            </table>
        </t>
    </template>

    <!-- Report Actions -->
    <record id="action_report_lms_course_completion" model="ir.actions.report">
        <field name="name">Course Completion Report</field>
        <field name="model">lms.course</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">LMS_and_marketplace.report_lms_course_completion</field>
        <field name="print_report_name">'course-completion-report'</field>
    </record>

    <record id="action_report_lms_corporate_training" model="ir.actions.report">
        <field name="name">Corporate Training Report</field>
        <field name="model">res.company</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">LMS_and_marketplace.report_lms_corporate_training</field>
        <field name="print_report_name">'corporate-training-report'</field>
    </record>
</odoo>