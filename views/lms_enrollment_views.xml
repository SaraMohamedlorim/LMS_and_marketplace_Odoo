<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Enrollment Tree View -->
    <record id="view_lms_enrollment_tree" model="ir.ui.view">
        <field name="name">lms.enrollment.tree</field>
        <field name="model">lms.enrollment</field>
        <field name="arch" type="xml">
            <tree decoration-success="state=='completed'" decoration-warning="state=='in_progress'" decoration-muted="state=='cancelled'">
                <field name="student_id"/>
                <field name="course_id"/>
                <field name="enrollment_date"/>
                <field name="state"/>
                <field name="progress" widget="progressbar"/>
                <field name="score" widget="percentpie"/>
                <field name="payment_status"/>
                <field name="completion_date"/>
            </tree>
        </field>
    </record>

    <!-- Enrollment Form View -->
    <record id="view_lms_enrollment_form" model="ir.ui.view">
        <field name="name">lms.enrollment.form</field>
        <field name="model">lms.enrollment</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_start_course" type="object" string="Start Course" 
                            class="btn-primary" attrs="{'invisible': [('state','!=','draft')]}"/>
                    <button name="action_complete_course" type="object" string="Mark Complete" 
                            class="btn-success" attrs="{'invisible': [('state','!=','in_progress')]}"/>
                    <button name="action_cancel_enrollment" type="object" string="Cancel" 
                            class="btn-danger" attrs="{'invisible': [('state','in',['completed','cancelled'])]}"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,in_progress,completed,cancelled"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="student_id" options="{'no_create': True}"/>
                            <field name="course_id" options="{'no_create': True}"/>
                            <field name="enrollment_date" readonly="1"/>
                            <field name="completion_date" readonly="1"/>
                        </group>
                        <group>
                            <field name="progress" widget="progressbar" options="{'editable': false}"/>
                            <field name="score" widget="percentpie"/>
                            <field name="payment_status"/>
                            <field name="is_corporate_enrollment" readonly="1"/>
                            <field name="company_id" readonly="1"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Content Progress">
                            <field name="content_progress_ids" mode="tree">
                                <tree default_order="module_id,content_id">
                                    <field name="content_id"/>
                                    <field name="module_id"/>
                                    <field name="state"/>
                                    <field name="start_date"/>
                                    <field name="completion_date"/>
                                    <field name="time_spent" string="Time Spent (min)"/>
                                    <field name="score" widget="percentpie"/>
                                </tree>
                            </field>
                        </page>
                        
                        <page string="Payment Information" attrs="{'invisible': [('payment_status','=','free')]}">
                            <group>
                                <field name="invoice_id" widget="many2one_button" options="{'no_create': True, 'no_open': True}"/>
                                <field name="payment_id" widget="many2one_button" options="{'no_create': True, 'no_open': True}"/>
                            </group>
                        </page>
                        
                        <page string="Certificate">
                            <field name="certificate_id" widget="many2one_button" options="{'no_create': True, 'no_open': True}"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Enrollment Search View -->
    <record id="view_lms_enrollment_search" model="ir.ui.view">
        <field name="name">lms.enrollment.search</field>
        <field name="model">lms.enrollment</field>
        <field name="arch" type="xml">
            <search>
                <field name="student_id"/>
                <field name="course_id"/>
                <field name="company_id"/>
                <filter string="In Progress" name="in_progress" domain="[('state','=','in_progress')]"/>
                <filter string="Completed" name="completed" domain="[('state','=','completed')]"/>
                <filter string="Corporate" name="corporate" domain="[('is_corporate_enrollment','=',True)]"/>
                <group expand="0" string="Group By">
                    <filter string="Course" name="course" context="{'group_by': 'course_id'}"/>
                    <filter string="Student" name="student" context="{'group_by': 'student_id'}"/>
                    <filter string="Status" name="status" context="{'group_by': 'state'}"/>
                    <filter string="Company" name="company" context="{'group_by': 'company_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Enrollment Action -->
    <record id="action_lms_enrollment" model="ir.actions.act_window">
        <field name="name">Enrollments</field>
        <field name="res_model">lms.enrollment</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_in_progress': 1}</field>
    </record>

    <!-- Content Progress Tree View -->
    <record id="view_lms_content_progress_tree" model="ir.ui.view">
        <field name="name">lms.content.progress.tree</field>
        <field name="model">lms.content.progress</field>
        <field name="arch" type="xml">
            <tree>
                <field name="enrollment_id" invisible="1"/>
                <field name="content_id"/>
                <field name="module_id"/>
                <field name="state"/>
                <field name="start_date"/>
                <field name="completion_date"/>
                <field name="time_spent"/>
                <field name="score" widget="percentpie"/>
            </tree>
        </field>
    </record>
</odoo>